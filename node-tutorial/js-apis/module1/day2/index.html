<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch CSV and Graph it</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>
<body>

    <h1>Global Average Temperatures 1880-2018</h1>

    <canvas id="chart" width="400" height="150">

    </canvas>

    
    <script>
        window.addEventListener('load',setup)
        async function setup() {

            const ctx = document.getElementById('chart').getContext('2d');
            const globalTemps = await getData();
            const myChart = new Chart(ctx, {
              type: 'line',
              data: {
                labels: globalTemps.xs,
                datasets: [
                  {
                    label: 'Temperature in Â°C',
                    data: globalTemps.ys,
                    fill: false,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.5)',
                    borderWidth: 1
                  }
                ]
              },
              options: {}
            });
          }
        async function getData(){
            const response = await fetch('ZonAnn.Ts+dSSt.csv');
            const data = await response.text();

            const rows = data.split('\n').slice(1);
            xs=[]
            ys=[]
            rows.forEach((row)=>{
                row=row.split(',');
                year=row[0]
                xs.push(year)
                temp=row[1]
                ys.push(parseFloat(row[1])+14)
            })
            return {xs,ys}
        }

    </script>
</body>
</html>